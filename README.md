
[1]: https://www.tuxcademy.org/download/de/adm1/adm1-de-manual.pdf "Tux Academy"
[2]: https://www.bitvise.com/ssh-client-download "Bitvise SSH/SFTP Client"

# Vagrant VM mit Docker

## Umgebung

Vagrant VM mit Docker. Die VM kann als Basis für Docker Konfigurationen eingesetzt werden. 

### VM Eigenschaften

* Ubuntu Jammy 64
* 2 GB Memory
* User - vagrant

### Personalisieren

Im File `scripts\add_ssh_pub.sh` können sie ihre persönlichen Public-Keys hinterlegen. Diesen tragen sie einfach wie unten dargestellt zwischen den Hochkommas `' ... '` ein. Dabei verwenden sie ihren eignene *public_key*.

```
#!/bin/sh

# hier den eigenen public-key eintragen
public_key='ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCxfc7YGRM0qDgkAFwwdrExJK9JUrZeypX+4wUAMdAIkbZ0bCclzV5Kpg9ZON7qlulhyEsRS+ZUtDZe+
ZANZhzpz4swte5ULTox9Mx3zj6PWWUXWD9RqHYnWeUEiP4OdDThuyDqlEKWvEy3u1WIxPEUiv3kjAiX2XR4MC0l5/OiJCP5ea8iXEiFI+NUzy7mCWuWW8Fp6iPX0giI4P
sD4fzBKuxC9SsdsirHOsIvMd5B8jaSdVvTa6qTj9J2bUSW6ANoSuG7J7m/3La4kJKjGBr7tsuELj5z0QSoEybZsU6KxWlDQwGGDV6OSQ8swfLFoJu7jckRupkBWHspuBk
+plpPmCt8Ean37MbCXNGk72sg+C8Qe1O3MzeDMTYrISssJD/UEkiJgJXpy97V5I9Cqfs3WNf7YZSErzKYAFjEjsishWu+ydveETfsMB+I/ledgu/gX/+Af5ZiyGApMTF+
ot9TzR3A0ojHHaEhJVOhTkgWu0aK+2rbtPwYEfEQMZYQiN0= Generated by vagrant '

# add public key for usr vagrant
echo $public_key >> /home/vagrant/.ssh/authorized_keys

# add public key for root
chmod 700 /root/.ssh
echo $public_key >> /root/.ssh/authorized_keys && chmod 600 /root/.ssh/authorized_keys
```


> **WICHTIG:** Den *public_key* müssen sie eintragen, **bevor** sie die VM mit `vagrant up` starten 

### Netzwerk

Die TCP-Portweiterleitung der VM ist wie folgt konfiguriert. Diese kann auch in den Einstellungen der VirtualBox eingesehen werden.

  |Verwendung| Host| VM | 
  |:--:|:--:|:--:|
  |ssh| 2222| 22 |
  |Web|8082|8082|

# Übungen

## Umgebung einrichten

Ziel ist es, die Umgebung so "bequem" wie möglich einzurichten. Dazu zählt insbesondere, dass wir auf einfach Art in die *Linux-VM* einloggen und dort Files erstellen und modifizieren können. Im Folgenden wird deshalb ein Weg (von vielen) aufgezeigt, wie von einem Windows-System in einer Linux-VM gearbeitet werden kann. Natürlich ersetzt das nicht die grundlegenden Linux Kenntnisse, aber es erleichtert zumindest die Arbeit. Gute Hilfestellungen zu Linux finden sie auf der [Tux Academy][1].

### VM starten

1) Starten sie die VM mit `vagrant up`
2) Testen sie die VM, indem sie sich mit `vagrant ssh` einloggen
   1) mit `sudo su -` auf den *root* Account switchen
   2) mit `docker ps` prüfen ob die Docker Umgebung läuft. Wenn alles gurt ist, siehrt der Output wie folgt aus

```
root@docker:/mnt/phpmyadmin# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```
3) mit `exit` und nochmals `exit` verlassen sie die VM wieder und sind somit wieder auf dem *Windows* System.


## SSH-Client

In den folgenden Abschnitten richten wir einen grafischen SSH/SFTP Client ein. Wir verwenden dazu den *opensource* [Bitvise][2] Client. Der Client ermöglicht einen einfachen Zugang zur Linux-VM und bietet zusätzlich die Möglichkeit, Files mit Hilfe des grafischen FTPS-Clients zwischen Windows und Linux zu transferieren. 

Wir führen folgende Schritte aus:

1. Client Installieren
2. SSH Key Pair einrichten 
3. SSH-Session auf Linux-VM einrichten
4. OpenSSH Public Key exportieren

SSH-Session auf Linux-VM einrichten




## Docker

### Anwendung *phpMyAdmin*

Wir starten nun unsere erste Container Basierte Applikation auf dieser VM. Diese besteht aus zwei Container mit folgenden Applikationen:

* MySQL Datenbank
* phpMyAdmin

Zum Starten der Container führen sie folgende Kommandos aus:

**MySQL**

` docker run -d --name db -v /tmp/data/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD='top-secret' mysql:5.7`

**phpMyAdmin**

`docker run -d --link db --name webserver -p 8082:80 phpmyadmin/phpmyadmin`

Nun können sie mit dem `docker ps` Kommando überprüfen, ob die beiden Container gestartet wurden. Sie sollten einen Output in der Art wie untenstehendn sehen:

```
root@docker:/mnt/phpmyadmin# docker ps
CONTAINER ID   IMAGE                   COMMAND                  CREATED          STATUS          PORTS                                   NAMES
630946b8e250   phpmyadmin/phpmyadmin   "/docker-entrypoint.…"   11 minutes ago   Up 11 minutes   0.0.0.0:8082->80/tcp, :::8082->80/tcp   webserver
8f5526028d72   mysql:5.7               "docker-entrypoint.s…"   12 minutes ago   Up 12 minutes   3306/tcp, 33060/tcp                     db
```

Alles klar? Gratuliere - sie haben erfolgreich eine Container basierende Applikation erstellt.

Sie können nun unter [localhost:8082](localhost:8082) auf die Applikation zugreifen und mit **root** und Passwort **top-secret** einloggen.

## Aufräumen

Führen sie einfach `vagrant destroy -f ` aus und die ganze Installation ist wieder weg. Sie wissen ja nun, wie schnell und einfach sie alles wieder erstellt haben :-)











  


